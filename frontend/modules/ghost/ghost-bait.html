<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAIT - Decoy Intelligence</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.15) 0%, rgba(0, 0, 0, 0.9) 100%);
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
            padding: 30px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-left img {
            height: 60px;
        }

        .header-content h1 {
            font-size: 2.5em;
            color: #D4AF37;
            font-weight: 700;
            letter-spacing: 3px;
            margin-bottom: 5px;
        }

        .header-content .subtitle {
            color: #888;
            font-size: 0.95em;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .header-content .description {
            color: #aaa;
            font-size: 0.9em;
            max-width: 700px;
            line-height: 1.5;
        }

        .back-button {
            padding: 12px 24px;
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 6px;
            color: #D4AF37;
            text-decoration: none;
            font-size: 0.95em;
            transition: all 0.3s;
        }

        .back-button:hover {
            background: rgba(212, 175, 55, 0.2);
            border-color: #D4AF37;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        }

        /* Main Container */
        .container {
            max-width: 1920px;
            margin: 0 auto;
            padding: 30px;
        }

        /* Three Column Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 400px 1fr 400px;
            gap: 25px;
        }

        @media (max-width: 1400px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Premium Card Styling */
        .card {
            background: #000000;
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            transition: all 0.3s;
        }

        .card:hover {
            border-color: #D4AF37;
            box-shadow: 0 8px 30px rgba(212, 175, 55, 0.2);
            transform: translateY(-2px);
        }

        .card-title {
            font-size: 1.3em;
            color: #D4AF37;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .badge {
            background: rgba(212, 175, 55, 0.2);
            color: #D4AF37;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 600;
        }

        /* Left Column - Deployment Control */
        .generate-section {
            margin-bottom: 25px;
        }

        .bait-type-selector {
            width: 100%;
            background: rgba(212, 175, 55, 0.05);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 8px;
            padding: 14px;
            color: #e0e0e0;
            font-size: 1em;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .bait-type-selector:hover {
            border-color: #D4AF37;
            background: rgba(212, 175, 55, 0.1);
        }

        .bait-type-selector option {
            background: #0a0a0a;
            padding: 10px;
        }

        .generate-btn, .deploy-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #D4AF37 0%, #B8941F 100%);
            border: none;
            border-radius: 8px;
            color: #000;
            font-size: 1.05em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }

        .generate-btn:hover, .deploy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(212, 175, 55, 0.5);
        }

        .generate-btn:active, .deploy-btn:active {
            transform: translateY(0);
        }

        .generate-btn:disabled, .deploy-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Result Display */
        .result-area {
            margin-top: 20px;
            display: none;
        }

        .result-area.show {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading-spinner {
            text-align: center;
            padding: 30px;
            color: #D4AF37;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(212, 175, 55, 0.3);
            border-top-color: #D4AF37;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .credential-block {
            background: rgba(212, 175, 55, 0.05);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .credential-item {
            margin-bottom: 12px;
        }

        .credential-label {
            color: #888;
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .credential-value {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 4px;
            color: #D4AF37;
            font-size: 0.9em;
            word-break: break-all;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .copy-btn {
            background: rgba(212, 175, 55, 0.2);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 4px;
            padding: 6px 12px;
            color: #D4AF37;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: rgba(212, 175, 55, 0.3);
        }

        .copy-btn.copied {
            background: rgba(16, 185, 129, 0.3);
            border-color: #10b981;
            color: #10b981;
        }

        /* Deployment Options */
        .deployment-options {
            margin-bottom: 25px;
        }

        .input-field {
            width: 100%;
            background: rgba(212, 175, 55, 0.05);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: #e0e0e0;
            font-size: 0.95em;
            margin-bottom: 15px;
        }

        .input-field:focus {
            outline: none;
            border-color: #D4AF37;
            background: rgba(212, 175, 55, 0.1);
        }

        .success-message {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
            border-radius: 8px;
            padding: 15px;
            color: #10b981;
            margin-top: 15px;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .success-message a {
            color: #10b981;
            text-decoration: underline;
        }

        /* Center Column - Active Honeytokens */
        .search-box {
            width: 100%;
            background: rgba(212, 175, 55, 0.05);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: #e0e0e0;
            font-size: 0.95em;
            margin-bottom: 20px;
        }

        .search-box:focus {
            outline: none;
            border-color: #D4AF37;
        }

        .honeytoken-card {
            background: rgba(212, 175, 55, 0.03);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .honeytoken-card:hover {
            border-color: #D4AF37;
            transform: translateX(5px);
        }

        .honeytoken-card.triggered {
            border-color: #ef4444;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            50% {
                box-shadow: 0 0 20px 10px rgba(239, 68, 68, 0);
            }
        }

        .honeytoken-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .type-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .type-badge.aws { background: rgba(255, 153, 0, 0.2); color: #ff9900; }
        .type-badge.stripe { background: rgba(99, 91, 255, 0.2); color: #635BFF; }
        .type-badge.database { background: rgba(59, 130, 246, 0.2); color: #3B82F6; }
        .type-badge.ssh { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .type-badge.github { background: rgba(139, 92, 246, 0.2); color: #8B5CF6; }
        .type-badge.slack { background: rgba(236, 72, 153, 0.2); color: #EC4899; }

        .demo-badge {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.2) 0%, rgba(212, 175, 55, 0.1) 100%);
            border: 1.5px solid rgba(212, 175, 55, 0.5);
            color: #D4AF37;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-left: 8px;
            animation: demoGlow 2s ease-in-out infinite;
        }

        @keyframes demoGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(212, 175, 55, 0.3); }
            50% { box-shadow: 0 0 15px rgba(212, 175, 55, 0.5); }
        }

        .demo-notice {
            background: rgba(212, 175, 55, 0.1);
            border-left: 3px solid #D4AF37;
            padding: 10px 12px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 0.85em;
            color: #D4AF37;
        }

        .honeytoken-id {
            font-family: 'Consolas', 'Monaco', monospace;
            color: #888;
            font-size: 0.9em;
        }

        .honeytoken-info {
            margin-bottom: 12px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 0.9em;
        }

        .info-label {
            color: #888;
        }

        .info-value {
            color: #D4AF37;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            margin-top: 10px;
        }

        .status-indicator.active {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .status-indicator.triggered {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .view-timeline-btn {
            width: 100%;
            padding: 10px;
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 6px;
            color: #D4AF37;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
            transition: all 0.2s;
        }

        .view-timeline-btn:hover {
            background: rgba(212, 175, 55, 0.2);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .empty-state-title {
            font-size: 1.3em;
            color: #D4AF37;
            margin-bottom: 10px;
        }

        /* Right Column - Live Intelligence Feed */
        .threat-feed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #ef4444;
            font-size: 0.9em;
        }

        .pulse-dot {
            width: 10px;
            height: 10px;
            background: #ef4444;
            border-radius: 50%;
            animation: pulseDot 2s infinite;
        }

        @keyframes pulseDot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .threat-item {
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid #ef4444;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 12px;
            animation: fadeIn 0.5s;
        }

        .threat-timestamp {
            color: #888;
            font-size: 0.85em;
            margin-bottom: 8px;
        }

        .threat-details {
            display: flex;
            flex-direction: column;
            gap: 6px;
            font-size: 0.9em;
        }

        .threat-ip {
            color: #D4AF37;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .threat-level {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .threat-level.critical {
            background: rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        .threat-level.high {
            background: rgba(251, 146, 60, 0.3);
            color: #fb923c;
        }

        .threat-level.medium {
            background: rgba(251, 191, 36, 0.3);
            color: #fbbf24;
        }

        .view-details-link {
            color: #D4AF37;
            text-decoration: none;
            font-size: 0.85em;
            margin-top: 8px;
            display: inline-block;
        }

        .view-details-link:hover {
            text-decoration: underline;
        }

        /* Statistics Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 25px;
        }

        .mini-stat {
            background: rgba(212, 175, 55, 0.05);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .mini-stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #D4AF37;
            margin-bottom: 5px;
        }

        .mini-stat-value.red {
            color: #ef4444;
        }

        .mini-stat-value.orange {
            color: #fb923c;
        }

        .mini-stat-label {
            font-size: 0.8em;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Threat Heatmap */
        .heatmap-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(212, 175, 55, 0.05);
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .heatmap-country {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .heatmap-count {
            color: #ef4444;
            font-weight: 600;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #000;
            border: 1px solid #D4AF37;
            border-radius: 8px;
            padding: 16px 24px;
            box-shadow: 0 4px 20px rgba(212, 175, 55, 0.3);
            z-index: 1000;
            animation: slideInRight 0.3s ease-out;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            border-color: #10b981;
            color: #10b981;
        }

        .toast.error {
            border-color: #ef4444;
            color: #ef4444;
        }

        /* Tabbed Interface */
        .tab-container {
            margin-bottom: 20px;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid rgba(212, 175, 55, 0.3);
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: #888;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            top: 2px;
        }

        .tab-btn:hover {
            color: #D4AF37;
        }

        .tab-btn.active {
            color: #D4AF37;
            border-bottom-color: #D4AF37;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        /* Timeline Visualization */
        .timeline-container {
            position: relative;
            padding-left: 30px;
        }

        .timeline-line {
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg, rgba(212, 175, 55, 0.5) 0%, rgba(212, 175, 55, 0.1) 100%);
        }

        .timeline-event {
            position: relative;
            margin-bottom: 25px;
            padding-left: 20px;
        }

        .timeline-event::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 5px;
            width: 12px;
            height: 12px;
            background: #D4AF37;
            border-radius: 50%;
            border: 2px solid #0a0a0a;
            z-index: 1;
        }

        .timeline-event.triggered::before {
            background: #ef4444;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
        }

        .timeline-event-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .timeline-icon {
            font-size: 1.2em;
        }

        .timeline-title {
            color: #D4AF37;
            font-weight: 600;
            font-size: 0.95em;
        }

        .timeline-time {
            color: #888;
            font-size: 0.85em;
            margin-left: auto;
        }

        .timeline-details {
            background: rgba(212, 175, 55, 0.05);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 6px;
            padding: 12px;
            margin-top: 8px;
            font-size: 0.9em;
        }

        .timeline-details-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            padding: 4px 0;
        }

        .timeline-details-row:last-child {
            margin-bottom: 0;
        }

        .timeline-label {
            color: #888;
        }

        .timeline-value {
            color: #e0e0e0;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .expandable-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .expandable-details.expanded {
            max-height: 500px;
        }

        .expand-indicator {
            color: #888;
            font-size: 0.8em;
            margin-left: 5px;
        }

        /* Scanner Badge */
        .scanner-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            background: rgba(212, 175, 55, 0.15);
            color: #D4AF37;
        }

        .scanner-badge.automated {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .scanner-badge.manual {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        /* Intelligence Summary */
        .intelligence-section {
            background: rgba(212, 175, 55, 0.05);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin-top: 25px;
        }

        .intelligence-title {
            color: #D4AF37;
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .intelligence-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .intelligence-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            padding: 12px;
        }

        .intelligence-item-label {
            color: #888;
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .intelligence-item-value {
            color: #D4AF37;
            font-size: 1.1em;
            font-weight: 600;
        }

        .intelligence-list {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            padding: 12px;
            margin-top: 10px;
        }

        .intelligence-list-title {
            color: #888;
            font-size: 0.85em;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .intelligence-list-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .intelligence-chip {
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 0.9em;
            color: #e0e0e0;
        }

        /* Country Flag Emoji */
        .country-flag {
            font-size: 1.2em;
            margin-right: 5px;
        }

        /* Back to Feed Button */
        .back-to-feed-btn {
            padding: 10px 16px;
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 6px;
            color: #D4AF37;
            cursor: pointer;
            font-size: 0.9em;
            margin-bottom: 15px;
            transition: all 0.2s;
        }

        .back-to-feed-btn:hover {
            background: rgba(212, 175, 55, 0.2);
        }

        /* IP Reputation Display */
        .ip-reputation-container {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 6px;
            padding: 15px;
            margin-top: 12px;
            animation: fadeIn 0.3s;
        }

        .ip-reputation-title {
            color: #D4AF37;
            font-weight: 600;
            font-size: 0.95em;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ip-reputation-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .ip-reputation-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85em;
        }

        .ip-reputation-icon {
            font-size: 1.1em;
        }

        .ip-reputation-label {
            color: #888;
        }

        .ip-reputation-value {
            color: #e0e0e0;
            font-weight: 500;
        }

        .ip-reputation-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .ip-reputation-badge.clean {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .ip-reputation-badge.suspicious {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .ip-reputation-badge.scanner {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .check-ip-btn {
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 4px;
            padding: 6px 12px;
            color: #D4AF37;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 8px;
        }

        .check-ip-btn:hover {
            background: rgba(212, 175, 55, 0.2);
        }

        .check-ip-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .ip-reputation-flags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        .ip-flag {
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.8em;
            color: #e0e0e0;
        }

        .ip-flag.warning {
            background: rgba(251, 191, 36, 0.2);
            border-color: rgba(251, 191, 36, 0.3);
            color: #fbbf24;
        }

        .ip-flag.danger {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <img src="ghost-logo.png" alt="GHOST">
            <div class="header-content">
                <h1>DECOY INTELLIGENCE</h1>
                <div class="subtitle">Reality-Integrated Honeytoken Deployment & Threat Detection</div>
                <div class="description">
                    Deploy fake credentials to public surfaces and monitor when attackers discover and attempt to use them.
                    Prove real-world adversary interest with concrete evidence.
                </div>
            </div>
        </div>
        <div style="display: flex; gap: 15px;">
            <button onclick="showTutorial()" class="back-button" style="cursor: pointer; background: rgba(212, 175, 55, 0.15);">
                [?] How to Use BAIT
            </button>
            <a href="ghost.html" class="back-button">← Back to GHOST</a>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <div class="main-grid">
            <!-- LEFT COLUMN - Deployment Control -->
            <div class="left-column">
                <!-- Generate Honeytoken -->
                <div class="card generate-section">
                    <div class="card-title">[GENERATE] Honeytoken</div>

                    <select class="bait-type-selector" id="baitType">
                        <option value="">Select credential type...</option>
                        <option value="aws_key">[AWS] Access Keys</option>
                        <option value="stripe_token">[STRIPE] API Token</option>
                        <option value="database">[DATABASE] Credentials</option>
                        <option value="ssh_key">[SSH] Private Key</option>
                        <option value="github_token">[GITHUB] Token</option>
                        <option value="slack_token">[SLACK] Token</option>
                    </select>

                    <button class="generate-btn" id="generateBtn">Generate Honeytoken</button>

                    <!-- Result Area -->
                    <div class="result-area" id="resultArea">
                        <div class="loading-spinner" id="loadingSpinner">
                            <div class="spinner"></div>
                            <p style="margin-top: 10px;">Generating...</p>
                        </div>

                        <div id="credentialDisplay" style="display: none;"></div>
                    </div>
                </div>

                <!-- Deployment Options -->
                <div class="card deployment-options" id="deploymentSection" style="display: none;">
                    <div class="card-title">[DEPLOY] Deployment Options</div>

                    <input type="text" class="input-field" id="pastebinTitle" placeholder="Pastebin title (e.g., 'AWS Config Backup')" value="Configuration Backup - DO NOT SHARE">

                    <label style="color: #888; font-size: 0.9em; margin-bottom: 8px; display: block;">Deployment Target</label>
                    <select class="bait-type-selector" id="deploymentTarget" style="margin-bottom: 15px;">
                        <option value="pastebin_public">Pastebin (Public)</option>
                        <option value="pastebin_unlisted">Pastebin (Unlisted)</option>
                        <option value="github_public">GitHub Gist (Public) - Coming Soon</option>
                        <option value="github_secret">GitHub Gist (Secret) - Coming Soon</option>
                        <option value="manual">Manual Deployment</option>
                    </select>

                    <div id="manualDeploymentArea" style="display: none;">
                        <div style="color: #888; font-size: 0.9em; margin-bottom: 10px;">
                            Copy this configuration and post it wherever you want attackers to find it:
                        </div>
                        <div style="background: rgba(0, 0, 0, 0.5); border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 15px; font-family: 'Consolas', 'Monaco', monospace; font-size: 0.85em; max-height: 300px; overflow-y: auto;">
                            <pre id="manualConfigDisplay" style="margin: 0; color: #D4AF37; white-space: pre-wrap; word-wrap: break-word;"></pre>
                        </div>
                        <button class="view-timeline-btn" onclick="copyManualConfig()" style="width: 100%; margin-bottom: 10px;">
                            Copy Configuration
                        </button>
                    </div>

                    <button class="deploy-btn" id="deployBtn">Deploy to Pastebin</button>

                    <div id="deploymentSuccess" style="display: none;"></div>
                </div>
            </div>

            <!-- CENTER COLUMN - Active Honeytokens -->
            <div class="center-column">
                <div class="card">
                    <div class="card-title">
                        Created Honeytokens
                        <span class="badge" id="honeytokenCount">0</span>
                    </div>

                    <select class="bait-type-selector" id="typeFilter" style="margin-bottom: 15px;">
                        <option value="">All Types</option>
                        <option value="aws_key">AWS Keys</option>
                        <option value="stripe_token">Stripe Tokens</option>
                        <option value="slack_token">Slack Tokens</option>
                        <option value="github_token">GitHub Tokens</option>
                        <option value="api_token">API Tokens</option>
                        <option value="database">Database</option>
                        <option value="ssh_key">SSH Keys</option>
                    </select>

                    <input type="text" class="search-box" id="searchBox" placeholder="Search honeytokens...">

                    <div id="honeytokenList">
                        <div class="empty-state">
                            <div class="empty-state-icon">🎣</div>
                            <div class="empty-state-title">No honeytokens deployed yet</div>
                            <div>Generate and deploy your first honeytoken to start detecting attackers</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT COLUMN - Live Intelligence Feed -->
            <div class="right-column">
                <!-- Threat Detection Feed with Tabs -->
                <div class="card">
                    <div class="threat-feed-header">
                        <div class="card-title">🚨 Threat Intelligence</div>
                        <div class="live-indicator">
                            <div class="pulse-dot"></div>
                            LIVE
                        </div>
                    </div>

                    <!-- Tab Buttons -->
                    <div class="tab-container">
                        <div class="tab-buttons">
                            <button class="tab-btn active" data-tab="liveFeed" onclick="switchTab('liveFeed')">Live Feed</button>
                            <button class="tab-btn" data-tab="timeline" onclick="switchTab('timeline')">Timeline</button>
                        </div>

                        <!-- TAB 1: Live Feed -->
                        <div id="liveFeedTab" class="tab-content active">
                            <div id="threatFeed">
                                <div class="empty-state">
                                    <div style="font-size: 0.9em; color: #888;">No threats detected yet</div>
                                </div>
                            </div>
                        </div>

                        <!-- TAB 2: Timeline -->
                        <div id="timelineTab" class="tab-content">
                            <button class="back-to-feed-btn" onclick="switchTab('liveFeed')" style="display: none;">
                                ← Back to Live Feed
                            </button>

                            <div id="timelineContent">
                                <div class="empty-state">
                                    <div style="font-size: 0.9em; color: #888;">Select a honeytoken to view its timeline</div>
                                </div>
                            </div>

                            <!-- Attacker Intelligence Section -->
                            <div id="attackerIntelligence" style="display: none;">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Statistics Dashboard -->
                <div class="card" style="margin-top: 25px;">
                    <div class="card-title">📊 Statistics Dashboard</div>

                    <div class="stats-grid">
                        <div class="mini-stat">
                            <div class="mini-stat-value" id="statTotalBaits">0</div>
                            <div class="mini-stat-label">Total Deployments</div>
                        </div>
                        <div class="mini-stat">
                            <div class="mini-stat-value red" id="statTotalAttempts">0</div>
                            <div class="mini-stat-label">Access Attempts</div>
                        </div>
                        <div class="mini-stat">
                            <div class="mini-stat-value orange" id="statUniqueIPs">0</div>
                            <div class="mini-stat-label">Unique IPs</div>
                        </div>
                        <div class="mini-stat">
                            <div class="mini-stat-value" id="statAvgTime">N/A</div>
                            <div class="mini-stat-label">Avg Discovery</div>
                        </div>
                    </div>
                </div>

                <!-- Threat Heatmap -->
                <div class="card" style="margin-top: 25px;">
                    <div class="card-title">🗺️ Threat Heatmap</div>
                    <div id="heatmapList">
                        <div class="empty-state">
                            <div style="font-size: 0.9em; color: #888;">No geographic data yet</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000';
        let currentGeneratedBait = null;
        let refreshInterval = null;

        // Demo Token Configuration
        const DEMO_TOKEN_ID = 'DEMO-TEST-TOKEN-001';

        // Create Demo Token Data
        function createDemoToken() {
            const twoDaysAgo = new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString();

            return {
                identifier: DEMO_TOKEN_ID,
                bait_type: 'aws_key',
                access_count: 5,
                seeded_at: twoDaysAgo,
                seeded_location: 'https://pastebin.com/demo123',
                status: 'DEMO - For Testing',
                is_demo: true,
                created_at: twoDaysAgo
            };
        }

        // Create Mock Timeline Data for Demo Token
        function getMockDemoTimeline() {
            const baseTime = new Date(Date.now() - 2 * 24 * 60 * 60 * 1000); // 2 days ago
            const deployTime = new Date(baseTime);

            const accesses = [
                {
                    id: 'demo-access-1',
                    accessed_at: new Date(deployTime.getTime() + 4 * 60 * 60 * 1000).toISOString(), // 4 hours after
                    source_ip: '185.220.101.45',
                    user_agent: 'python-requests/2.28.0',
                    geolocation: JSON.stringify({ country: 'Russia', city: 'Moscow', latitude: 55.7558, longitude: 37.6173 }),
                    headers: JSON.stringify({ 'User-Agent': 'python-requests/2.28.0', 'Accept': '*/*' }),
                    request_data: JSON.stringify({ method: 'GET' }),
                    threat_level: 'HIGH',
                    scanner_type: 'Python Script (Automated)'
                },
                {
                    id: 'demo-access-2',
                    accessed_at: new Date(deployTime.getTime() + 8 * 60 * 60 * 1000).toISOString(), // 8 hours after
                    source_ip: '47.88.54.23',
                    user_agent: 'aws-cli/2.13.0',
                    geolocation: JSON.stringify({ country: 'China', city: 'Shanghai', latitude: 31.2304, longitude: 121.4737 }),
                    headers: JSON.stringify({ 'User-Agent': 'aws-cli/2.13.0', 'Accept': 'application/json' }),
                    request_data: JSON.stringify({ method: 'POST' }),
                    threat_level: 'CRITICAL',
                    scanner_type: 'AWS CLI (Manual)'
                },
                {
                    id: 'demo-access-3',
                    accessed_at: new Date(deployTime.getTime() + 12 * 60 * 60 * 1000).toISOString(), // 12 hours after
                    source_ip: '104.244.72.115',
                    user_agent: 'curl/7.68.0',
                    geolocation: JSON.stringify({ country: 'USA', city: 'Los Angeles', latitude: 34.0522, longitude: -118.2437 }),
                    headers: JSON.stringify({ 'User-Agent': 'curl/7.68.0' }),
                    request_data: JSON.stringify({ method: 'GET' }),
                    threat_level: 'MEDIUM',
                    scanner_type: 'cURL (Manual)'
                },
                {
                    id: 'demo-access-4',
                    accessed_at: new Date(deployTime.getTime() + 24 * 60 * 60 * 1000).toISOString(), // 1 day after
                    source_ip: '185.220.101.45',
                    user_agent: 'python-requests/2.28.0',
                    geolocation: JSON.stringify({ country: 'Russia', city: 'Moscow', latitude: 55.7558, longitude: 37.6173 }),
                    headers: JSON.stringify({ 'User-Agent': 'python-requests/2.28.0', 'Accept': '*/*', 'X-Note': 'Repeat attacker' }),
                    request_data: JSON.stringify({ method: 'GET', note: 'Repeat attacker' }),
                    threat_level: 'HIGH',
                    scanner_type: 'Python Script (Automated)'
                },
                {
                    id: 'demo-access-5',
                    accessed_at: new Date(deployTime.getTime() + 36 * 60 * 60 * 1000).toISOString(), // 1.5 days after
                    source_ip: '91.203.5.146',
                    user_agent: 'Boto3/1.26.0 Python/3.9.7',
                    geolocation: JSON.stringify({ country: 'Netherlands', city: 'Amsterdam', latitude: 52.3676, longitude: 4.9041 }),
                    headers: JSON.stringify({ 'User-Agent': 'Boto3/1.26.0 Python/3.9.7' }),
                    request_data: JSON.stringify({ method: 'POST' }),
                    threat_level: 'HIGH',
                    scanner_type: 'AWS SDK (Automated)'
                }
            ];

            return {
                success: true,
                timeline: {
                    identifier: DEMO_TOKEN_ID,
                    bait_type: 'aws_key',
                    created_at: baseTime.toISOString(),
                    seeded_at: deployTime.toISOString(),
                    seeded_location: 'https://pastebin.com/demo123',
                    first_access: accesses[0].accessed_at,
                    accesses: accesses,
                    is_demo: true
                }
            };
        }

        // Initialize on page load
        window.addEventListener('load', function() {
            loadActiveHoneytokens();
            loadTriggeredBaits();
            refreshStats();

            // Auto-refresh every 10 seconds
            refreshInterval = setInterval(() => {
                loadTriggeredBaits();
                refreshStats();
            }, 10000);

            // Update time displays every minute to keep "X minutes ago" accurate
            setInterval(() => {
                loadActiveHoneytokens(); // Refresh to update time displays
            }, 60000); // 60 seconds
        });

        // Generate Button
        document.getElementById('generateBtn').addEventListener('click', async function() {
            const baitType = document.getElementById('baitType').value;

            if (!baitType) {
                showToast('Please select a credential type', 'error');
                return;
            }

            const resultArea = document.getElementById('resultArea');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const credentialDisplay = document.getElementById('credentialDisplay');
            const generateBtn = this;

            // Show loading state
            resultArea.classList.add('show');
            loadingSpinner.style.display = 'block';
            credentialDisplay.style.display = 'none';
            generateBtn.disabled = true;

            try {
                // Log the request being sent
                const requestBody = { type: baitType };
                console.log('\n=== BAIT GENERATION REQUEST ===');
                console.log('Request body:', requestBody);
                console.log('Request URL:', `${API_URL}/api/ghost/bait/generate`);

                const response = await fetch(`${API_URL}/api/ghost/bait/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                // Log full response details
                console.log('\n=== BAIT GENERATION RESPONSE ===');
                console.log('Response status:', response.status, response.statusText);
                console.log('Response ok:', response.ok);
                console.log('Response headers:', {
                    'content-type': response.headers.get('content-type'),
                    'content-length': response.headers.get('content-length')
                });

                // Read response as text first
                const responseText = await response.text();
                console.log('Raw response text:', responseText);
                console.log('Response text length:', responseText.length);

                // Check if response is ok before parsing
                if (!response.ok) {
                    console.error('❌ Response not OK');
                    console.error('Status code:', response.status);
                    console.error('Response body:', responseText);

                    // Try to parse as JSON if possible
                    try {
                        const errorData = JSON.parse(responseText);
                        console.error('Parsed error data:', errorData);
                        throw new Error(errorData.error || `Server error: ${response.status}`);
                    } catch (parseError) {
                        console.error('Could not parse error as JSON:', parseError);
                        // If not JSON, use the text directly
                        throw new Error(responseText || `Server error: ${response.status} ${response.statusText}`);
                    }
                }

                // Parse successful response as JSON
                let data;
                try {
                    data = JSON.parse(responseText);
                    console.log('✓ Parsed JSON data:', data);
                } catch (parseError) {
                    console.error('❌ Failed to parse response as JSON:', parseError);
                    console.error('Response was:', responseText);
                    throw new Error('Server returned invalid response format');
                }

                // Check if generation was successful
                console.log('Checking data.success:', data.success);
                console.log('Checking data.data:', data.data ? 'exists' : 'missing');

                if (data.success && data.data) {
                    console.log('✓ Generation successful!');
                    console.log('Generated bait data:', data.data);
                    console.log('Bait identifier:', data.data.identifier);
                    console.log('Bait type:', data.data.type);

                    currentGeneratedBait = data.data;
                    displayGeneratedCredential(data.data);
                    document.getElementById('deploymentSection').style.display = 'block';
                    showToast('Honeytoken generated successfully!', 'success');

                    // Auto-refresh the active honeytokens list
                    console.log('Auto-refreshing honeytoken list...');
                    setTimeout(() => {
                        loadActiveHoneytokens();
                        refreshStats();
                    }, 500);

                    console.log('=== GENERATION COMPLETE ===\n');
                } else {
                    console.error('❌ Generation failed');
                    console.error('data.success:', data.success);
                    console.error('data.error:', data.error);
                    throw new Error(data.error || 'Failed to generate honeytoken - no data returned');
                }
            } catch (error) {
                console.error('\n❌ Generation error occurred:');
                console.error('Error type:', error.constructor.name);
                console.error('Error message:', error.message);
                console.error('Full error:', error);
                console.error('=== GENERATION FAILED ===\n');

                showToast('Error generating honeytoken: ' + error.message, 'error');
                resultArea.classList.remove('show');
            } finally {
                loadingSpinner.style.display = 'none';
                generateBtn.disabled = false;
            }
        });

        // Display Generated Credential
        function displayGeneratedCredential(credential) {
            console.log('Displaying credential:', credential);
            console.log('Credential type:', credential.type);

            // credential is already a parsed JavaScript object - don't parse it again
            const credentialDisplay = document.getElementById('credentialDisplay');

            let html = '<div class="credential-block">';
            html += `<div style="color: #D4AF37; font-weight: 600; margin-bottom: 15px;">Identifier: ${credential.identifier}</div>`;
            html += `<div style="color: #888; font-size: 0.9em; margin-bottom: 20px;">Type: ${formatBaitType(credential.type)}</div>`;

            // Display credentials based on type
            const credType = credential.type;

            if (credType === 'aws_credentials') {
                // AWS Credentials
                html += createCredentialItem('AWS Access Key ID', credential.aws_access_key_id);
                html += createCredentialItem('AWS Secret Access Key', credential.aws_secret_access_key);
                if (credential.aws_session_token) {
                    html += createCredentialItem('Session Token', credential.aws_session_token);
                }
                html += createCredentialItem('Region', credential.region);
                html += createCredentialItem('Account ID', credential.account_id);

            } else if (credType === 'api_token') {
                // API Token (Stripe, GitHub, Slack, etc.)
                html += createCredentialItem('Service', credential.service_name);
                html += createCredentialItem('API Token', credential.token);

            } else if (credType === 'database_credentials') {
                // Database Credentials
                html += createCredentialItem('Database Type', credential.db_type);
                html += createCredentialItem('Host', credential.host);
                html += createCredentialItem('Port', credential.port);
                html += createCredentialItem('Database', credential.database);
                html += createCredentialItem('Username', credential.username);
                html += createCredentialItem('Password', credential.password);
                html += createCredentialItem('Connection String', credential.connection_string);

            } else if (credType === 'ssh_key') {
                // SSH Key
                html += createCredentialItem('Key Name', credential.key_name);
                html += createCredentialItem('Key Comment', credential.key_comment);
                html += createCredentialItem('Fingerprint', credential.fingerprint);
                html += createCredentialItem('Public Key', credential.public_key, true);
                html += createCredentialItem('Private Key', credential.private_key, true);

            } else if (credType === 'jwt_token') {
                // JWT Token
                html += createCredentialItem('Service', credential.service_name);
                html += createCredentialItem('JWT Token', credential.token);

            } else if (credType === 'oauth_token') {
                // OAuth Token
                html += createCredentialItem('Provider', credential.provider);
                html += createCredentialItem('Access Token', credential.access_token);
                html += createCredentialItem('Refresh Token', credential.refresh_token);
                html += createCredentialItem('Token Type', credential.token_type);

            } else {
                // Fallback: display all properties
                console.log('Unknown credential type, displaying all properties');
                for (const [key, value] of Object.entries(credential)) {
                    if (key !== 'tracking_id' && key !== 'identifier' && key !== 'type' &&
                        key !== 'generated_at' && key !== 'description' && key !== 'db_id') {
                        html += createCredentialItem(formatLabel(key), value);
                    }
                }
            }

            html += '</div>';
            credentialDisplay.innerHTML = html;
            credentialDisplay.style.display = 'block';
        }

        // Helper function to create credential display item
        function createCredentialItem(label, value, isMultiline = false) {
            if (!value) return '';

            const displayValue = isMultiline ? truncateValue(String(value), 100) : String(value);
            const fullValue = String(value);

            return `
                <div class="credential-item">
                    <div class="credential-label">${label}</div>
                    <div class="credential-value">
                        <span class="value-text" style="${isMultiline ? 'word-break: break-all; font-size: 0.85em;' : ''}">${escapeHtml(displayValue)}</span>
                        <button class="copy-btn" onclick="copyToClipboard(\`${escapeHtml(fullValue)}\`, this)">Copy</button>
                    </div>
                </div>
            `;
        }

        // Deploy Button
        document.getElementById('deployBtn').addEventListener('click', async function() {
            if (!currentGeneratedBait) {
                showToast('No honeytoken to deploy', 'error');
                return;
            }

            const title = document.getElementById('pastebinTitle').value;
            const deployBtn = this;
            deployBtn.disabled = true;
            deployBtn.textContent = 'Deploying...';

            try {
                // Log the request being sent
                const requestBody = {
                    identifier: currentGeneratedBait.identifier,
                    title: title
                };
                console.log('Sending deploy request:', requestBody);

                const response = await fetch(`${API_URL}/api/ghost/bait/seed`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                // Log response status
                console.log('Deploy response status:', response.status, response.statusText);

                // Check if response is ok before parsing
                if (!response.ok) {
                    // Try to read as text first for error messages
                    const errorText = await response.text();
                    console.error('Deploy error response body:', errorText);

                    // Try to parse as JSON if possible
                    try {
                        const errorData = JSON.parse(errorText);
                        throw new Error(errorData.error || `Server error: ${response.status}`);
                    } catch (parseError) {
                        // If not JSON, use the text directly
                        throw new Error(errorText || `Server error: ${response.status} ${response.statusText}`);
                    }
                }

                // Try to parse successful response as JSON
                let data;
                try {
                    const responseText = await response.text();
                    console.log('Deploy response body:', responseText);
                    data = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('Failed to parse deploy response as JSON:', parseError);
                    throw new Error('Server returned invalid response format');
                }

                // Check if deployment was successful
                if (data.success && data.url) {
                    console.log('Successfully deployed to:', data.url);
                    const successDiv = document.getElementById('deploymentSuccess');
                    successDiv.innerHTML = `
                        <div class="success-message">
                            Successfully deployed!<br>
                            <a href="${data.url}" target="_blank">${data.url}</a>
                        </div>
                    `;
                    successDiv.style.display = 'block';
                    showToast('Honeytoken deployed to Pastebin!', 'success');

                    // Refresh the list
                    setTimeout(() => {
                        loadActiveHoneytokens();
                        refreshStats();
                    }, 1000);
                } else {
                    throw new Error(data.error || 'Deployment failed - no URL returned');
                }
            } catch (error) {
                console.error('Deployment error:', error);
                showToast('Error deploying honeytoken: ' + error.message, 'error');
            } finally {
                deployBtn.disabled = false;
                deployBtn.textContent = 'Deploy to Pastebin';
            }
        });

        // Load Active Honeytokens
        async function loadActiveHoneytokens() {
            try {
                const response = await fetch(`${API_URL}/api/ghost/bait/active`);
                const data = await response.json();

                if (data.success) {
                    let baits = data.baits || [];

                    // Inject demo token at the beginning if not already present
                    const hasDemoToken = baits.some(bait => bait.identifier === DEMO_TOKEN_ID);
                    if (!hasDemoToken) {
                        baits = [createDemoToken(), ...baits];
                    }

                    displayHoneytokens(baits);
                    document.getElementById('honeytokenCount').textContent = data.count || 0;
                }
            } catch (error) {
                console.error('Error loading active honeytokens:', error);
                // Even on error, show demo token
                displayHoneytokens([createDemoToken()]);
            }
        }

        // Load Triggered Baits
        async function loadTriggeredBaits() {
            try {
                const response = await fetch(`${API_URL}/api/ghost/bait/triggered`);
                const data = await response.json();

                if (data.success && data.baits && data.baits.length > 0) {
                    displayThreatFeed(data.baits);
                }
            } catch (error) {
                console.error('Error loading triggered baits:', error);
            }
        }

        // Load Statistics
        async function loadStats() {
            try {
                const response = await fetch(`${API_URL}/api/ghost/bait/stats`);
                const data = await response.json();

                if (data.success && data.stats) {
                    document.getElementById('statTotalBaits').textContent = data.stats.total_baits || 0;
                    document.getElementById('statTotalAttempts').textContent = data.stats.total_attempts || 0;
                    document.getElementById('statUniqueIPs').textContent = data.stats.unique_ips || 0;
                    document.getElementById('statAvgTime').textContent = 'N/A'; // Can be calculated from data
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Display Honeytokens
        //Store all baits for filtering
        let allBaits = [];

        function displayHoneytokens(baits) {
            // Store baits for filtering
            allBaits = baits || [];

            const container = document.getElementById('honeytokenList');

            if (!baits || baits.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">🎣</div>
                        <div class="empty-state-title">No honeytokens deployed yet</div>
                        <div>Generate and deploy your first honeytoken to start detecting attackers</div>
                    </div>
                `;
                return;
            }

            let html = '';
            baits.forEach(bait => {
                // Null safety checks
                const identifier = bait.identifier || 'unknown';
                const baitType = bait.bait_type || 'unknown';
                const serviceName = bait.service_name || null;
                const accessCount = bait.access_count || 0;
                const isTriggered = accessCount > 0;
                const seededAt = bait.seeded_at || null;
                const seededLocation = bait.seeded_location || null;
                const isDemo = bait.is_demo || bait.identifier === DEMO_TOKEN_ID;

                html += `
                    <div class="honeytoken-card ${isTriggered ? 'triggered' : ''}" data-bait-type="${baitType}" data-service-name="${serviceName || ''}" data-bait-id="${identifier}">
                        <div class="honeytoken-header">
                            <span class="type-badge ${getBaitTypeClass(baitType)}">
                                ${getBaitTypeIcon(baitType)} ${formatBaitType(bait)}
                            </span>
                            ${isDemo ? '<span class="demo-badge">DEMO TOKEN</span>' : ''}
                            <span class="honeytoken-id">${identifier}</span>
                        </div>
                        ${isDemo ? '<div class="demo-notice">This is example data for demonstration purposes</div>' : ''}
                        <div class="honeytoken-info">
                            <div class="info-row">
                                <span class="info-label">Deployed:</span>
                                <span class="info-value">${seededAt ? formatRelativeTime(seededAt) : 'Unknown'}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Location:</span>
                                <span class="info-value">${seededLocation ? (seededLocation.includes('pastebin') ? 'Pastebin' : 'External') : 'Not seeded'}</span>
                            </div>
                        </div>
                        <div class="status-indicator ${isTriggered ? 'triggered' : 'active'}">
                            ${isTriggered ? `TRIGGERED (${accessCount} access${accessCount > 1 ? 'es' : ''})` : 'ACTIVE - Monitoring'}
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                            ${seededLocation ? `
                                <button class="view-timeline-btn" disabled style="background: rgba(16, 185, 129, 0.1); border-color: #10b981; color: #10b981; cursor: default;">
                                    Deployed
                                </button>
                                <a href="${seededLocation}" target="_blank" class="view-details-link" onclick="event.stopPropagation()" style="display: inline-block; padding: 8px 12px; text-decoration: none;">View Location →</a>
                            ` : `
                                <button class="view-timeline-btn" onclick="event.stopPropagation(); openDeployModal('${identifier}')" style="background: rgba(212, 175, 55, 0.1); border-color: #D4AF37; color: #D4AF37;">
                                    Deploy
                                </button>
                            `}
                            <button class="view-timeline-btn" onclick="event.stopPropagation(); viewTimeline('${identifier}')">
                                View Timeline
                            </button>
                            <button class="view-timeline-btn" onclick="event.stopPropagation(); deleteBait('${identifier}')" style="background: rgba(239, 68, 68, 0.1); border-color: #ef4444; color: #ef4444;" ${isDemo ? 'disabled title="Demo token cannot be deleted"' : ''}>
                                Delete
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Display Threat Feed
        function displayThreatFeed(baits) {
            const container = document.getElementById('threatFeed');
            let html = '';

            // Get recent accesses (max 10)
            const recentAccesses = [];
            baits.forEach(bait => {
                if (bait.latest_access) {
                    recentAccesses.push({
                        ...bait.latest_access,
                        bait_identifier: bait.identifier,
                        bait_type: bait.bait_type
                    });
                }
            });

            // Sort by time
            recentAccesses.sort((a, b) => new Date(b.accessed_at) - new Date(a.accessed_at));

            if (recentAccesses.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 0.9em; color: #888;">No threats detected yet</div>
                    </div>
                `;
                return;
            }

            recentAccesses.slice(0, 10).forEach(access => {
                html += `
                    <div class="threat-item">
                        <div class="threat-timestamp">${formatTimestamp(access.accessed_at)}</div>
                        <div class="threat-details">
                            <div>
                                <strong>IP:</strong>
                                <span class="threat-ip">${access.source_ip}</span>
                                ${access.geolocation && access.geolocation !== 'Unknown' ? ` 🌍 ${access.geolocation}` : ''}
                            </div>
                            <div>
                                <span class="threat-level ${access.threat_level}">${access.threat_level.toUpperCase()}</span>
                            </div>
                            <div><strong>Scanner:</strong> ${extractScanner(access.user_agent)}</div>
                            <div><strong>Target:</strong> ${access.bait_identifier}</div>
                        </div>
                        <a href="javascript:void(0)" onclick="viewTimeline('${access.bait_identifier}')" class="view-details-link">View Full Details →</a>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // View Timeline
        function viewTimeline(identifier) {
            window.location.href = `ghost-bait-timeline.html?id=${identifier}`;
        }

        // Utility Functions
        function formatLabel(key) {
            return key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        function truncateValue(value, maxLength = 50) {
            if (typeof value !== 'string') return value;
            return value.length > maxLength ? value.substring(0, maxLength) + '...' : value;
        }

        function escapeHtml(text) {
            if (text == null) return '';
            const str = String(text);
            const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
            return str.replace(/[&<>"']/g, m => map[m]);
        }

        async function copyToClipboard(text, button) {
            try {
                await navigator.clipboard.writeText(text);
                button.classList.add('copied');
                button.textContent = 'Copied';
                setTimeout(() => {
                    button.classList.remove('copied');
                    button.textContent = 'Copy';
                }, 2000);
            } catch (error) {
                showToast('Failed to copy', 'error');
            }
        }

        function formatRelativeTime(timestamp) {
            if (!timestamp) return 'Unknown';
            const date = new Date(timestamp);
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);

            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(seconds / 3600);
            const days = Math.floor(seconds / 86400);

            if (seconds < 60) return 'Just now';
            if (seconds < 3600) return `${minutes} minute${minutes !== 1 ? 's' : ''} ago`;
            if (seconds < 86400) return `${hours} hour${hours !== 1 ? 's' : ''} ago`;
            return `${days} day${days !== 1 ? 's' : ''} ago`;
        }

        function formatTimestamp(timestamp) {
            if (!timestamp) return 'Unknown';
            const date = new Date(timestamp);
            return date.toLocaleString();
        }

        function getBaitTypeIcon(type) {
            // Icons removed for cleaner UI
            return '';
        }

        function getBaitTypeClass(type) {
            const map = {
                'aws_key': 'aws',
                'stripe_token': 'stripe',
                'database': 'database',
                'ssh_key': 'ssh',
                'github_token': 'github',
                'slack_token': 'slack'
            };
            return map[type] || 'aws';
        }

        function formatBaitType(typeOrBait, serviceName = null) {
            // Handle both string and object input
            let type, service;
            if (typeof typeOrBait === 'object' && typeOrBait !== null) {
                type = typeOrBait.bait_type || typeOrBait.type;
                service = typeOrBait.service_name || serviceName;
            } else {
                type = typeOrBait;
                service = serviceName;
            }

            // If type is api_token and service_name exists, return "{service} API Token"
            if (type === 'api_token' && service) {
                const serviceCap = service.charAt(0).toUpperCase() + service.slice(1);
                return `${serviceCap} API Token`;
            }

            // Default formatting
            return type.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        function extractScanner(userAgent) {
            if (!userAgent) return 'Unknown';

            const ua = userAgent.toLowerCase();
            if (ua.includes('curl')) return 'curl';
            if (ua.includes('python')) return 'Python script';
            if (ua.includes('aws-cli')) return 'AWS CLI';
            if (ua.includes('postman')) return 'Postman';
            if (ua.includes('insomnia')) return 'Insomnia';
            if (ua.includes('wget')) return 'wget';
            if (ua.includes('scanner')) return 'Security Scanner';
            if (ua.includes('bot')) return 'Bot';

            return userAgent.substring(0, 30) + (userAgent.length > 30 ? '...' : '');
        }

        // Enhanced Scanner Identification
        function identifyScanner(userAgent) {
            if (!userAgent) return { name: 'Unknown Tool', type: 'unknown', isAutomated: false };

            const ua = userAgent.toLowerCase();

            // Manual tools
            if (ua.includes('curl')) return { name: 'cURL', type: 'manual', isAutomated: false };
            if (ua.includes('postman')) return { name: 'Postman', type: 'manual', isAutomated: false };
            if (ua.includes('insomnia')) return { name: 'Insomnia', type: 'manual', isAutomated: false };
            if (ua.includes('httpie')) return { name: 'HTTPie', type: 'manual', isAutomated: false };

            // AWS tools
            if (ua.includes('aws-cli')) return { name: 'AWS CLI', type: 'manual', isAutomated: false };
            if (ua.includes('boto')) return { name: 'AWS SDK (Boto)', type: 'automated', isAutomated: true };

            // Automated scripts
            if (ua.includes('python-requests')) return { name: 'Python Requests', type: 'automated', isAutomated: true };
            if (ua.includes('python-urllib')) return { name: 'Python urllib', type: 'automated', isAutomated: true };
            if (ua.includes('python')) return { name: 'Python Script', type: 'automated', isAutomated: true };
            if (ua.includes('go-http-client')) return { name: 'Go HTTP Client', type: 'automated', isAutomated: true };
            if (ua.includes('node-fetch')) return { name: 'Node.js Script', type: 'automated', isAutomated: true };
            if (ua.includes('axios')) return { name: 'Axios (Node.js)', type: 'automated', isAutomated: true };

            // Scanners
            if (ua.includes('masscan')) return { name: 'Masscan', type: 'automated', isAutomated: true };
            if (ua.includes('nmap')) return { name: 'Nmap', type: 'automated', isAutomated: true };
            if (ua.includes('zgrab')) return { name: 'ZGrab', type: 'automated', isAutomated: true };
            if (ua.includes('scanner')) return { name: 'Security Scanner', type: 'automated', isAutomated: true };
            if (ua.includes('bot')) return { name: 'Bot', type: 'automated', isAutomated: true };

            // Other tools
            if (ua.includes('wget')) return { name: 'wget', type: 'manual', isAutomated: false };
            if (ua.includes('powershell')) return { name: 'PowerShell', type: 'automated', isAutomated: true };

            return { name: 'Unknown Tool', type: 'unknown', isAutomated: false };
        }

        // Get Country Flag Emoji
        function getCountryFlag(country) {
            if (!country || country === 'Unknown') return '🏳️';

            const flagMap = {
                'United States': '🇺🇸',
                'United Kingdom': '🇬🇧',
                'China': '🇨🇳',
                'Russia': '🇷🇺',
                'Germany': '🇩🇪',
                'France': '🇫🇷',
                'India': '🇮🇳',
                'Brazil': '🇧🇷',
                'Canada': '🇨🇦',
                'Australia': '🇦🇺',
                'Japan': '🇯🇵',
                'South Korea': '🇰🇷',
                'Netherlands': '🇳🇱',
                'Singapore': '🇸🇬',
                'Mexico': '🇲🇽',
                'Spain': '🇪🇸',
                'Italy': '🇮🇹',
                'Poland': '🇵🇱',
                'Ukraine': '🇺🇦',
                'Romania': '🇷🇴'
            };

            return flagMap[country] || '🌍';
        }

        // Switch Tab Function
        function switchTab(tabName) {
            // Remove active class from all tabs
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Add active class to selected tab
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}Tab`).classList.add('active');

            // Show/hide back button
            const backBtn = document.querySelector('.back-to-feed-btn');
            if (tabName === 'timeline' && document.getElementById('timelineContent').querySelector('.timeline-container')) {
                backBtn.style.display = 'block';
            } else {
                backBtn.style.display = 'none';
            }
        }

        // View Timeline - Updated
        async function viewTimeline(identifier) {
            try {
                console.log('Fetching timeline for:', identifier);

                // Switch to timeline tab
                switchTab('timeline');

                // Show loading state
                document.getElementById('timelineContent').innerHTML = `
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <p style="margin-top: 10px;">Loading timeline...</p>
                    </div>
                `;

                // Check if this is the demo token
                let data;
                if (identifier === DEMO_TOKEN_ID) {
                    // Use mock data for demo token
                    console.log('Loading demo token timeline');
                    data = getMockDemoTimeline();
                } else {
                    // Fetch real data for non-demo tokens
                    const response = await fetch(`${API_URL}/api/ghost/bait/timeline/${identifier}`);
                    data = await response.json();
                }

                if (data.success && data.timeline) {
                    renderTimelineVisualization(data.timeline, identifier);
                    renderAttackerIntelligence(data.timeline, identifier);
                    document.querySelector('.back-to-feed-btn').style.display = 'block';
                } else {
                    throw new Error(data.error || 'Failed to load timeline');
                }
            } catch (error) {
                console.error('Timeline error:', error);
                document.getElementById('timelineContent').innerHTML = `
                    <div class="empty-state">
                        <div style="color: #ef4444;">Error loading timeline</div>
                        <div style="font-size: 0.9em; color: #888; margin-top: 10px;">${error.message}</div>
                    </div>
                `;
            }
        }

        // Render Timeline Visualization
        function renderTimelineVisualization(timeline, identifier) {
            console.log('\n=== TIMELINE VISUALIZATION ===');
            console.log('Timeline data received:', timeline);
            console.log('Identifier:', identifier);
            console.log('Has accesses:', timeline.accesses ? timeline.accesses.length : 0);
            console.log('Created at:', timeline.created_at);
            console.log('Seeded at:', timeline.seeded_at);
            console.log('Full timeline object:', JSON.stringify(timeline, null, 2));

            const container = document.getElementById('timelineContent');
            const isDemo = timeline.is_demo || identifier === DEMO_TOKEN_ID;

            let html = `
                <div style="color: #D4AF37; font-weight: 600; font-size: 1.1em; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                    Timeline: ${identifier}
                    ${isDemo ? '<span class="demo-badge">DEMO DATA</span>' : ''}
                </div>
                ${isDemo ? '<div class="demo-notice" style="margin-bottom: 20px;">This timeline shows example attack data for demonstration purposes</div>' : ''}
                <div class="timeline-container">
                    <div class="timeline-line"></div>
            `;

            // Created event
            if (timeline.created_at) {
                console.log('Rendering created event');
                html += `
                    <div class="timeline-event">
                        <div class="timeline-event-header">
                            <span class="timeline-icon">[CREATED]</span>
                            <span class="timeline-title">Honeytoken Created</span>
                            <span class="timeline-time">${formatTimestamp(timeline.created_at)}</span>
                        </div>
                        <div class="timeline-details">
                            <div class="timeline-details-row">
                                <span class="timeline-label">Type:</span>
                                <span class="timeline-value">${formatBaitType(timeline.bait_type)}</span>
                            </div>
                            <div class="timeline-details-row">
                                <span class="timeline-label">Identifier:</span>
                                <span class="timeline-value">${timeline.identifier}</span>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                console.log('No created_at timestamp found');
            }

            // Deployed event
            if (timeline.seeded_at) {
                console.log('Rendering deployed event');
                html += `
                    <div class="timeline-event">
                        <div class="timeline-event-header">
                            <span class="timeline-icon">[DEPLOYED]</span>
                            <span class="timeline-title">Deployed to Public Surface</span>
                            <span class="timeline-time">${formatTimestamp(timeline.seeded_at)}</span>
                        </div>
                        <div class="timeline-details">
                            <div class="timeline-details-row">
                                <span class="timeline-label">Location:</span>
                                <span class="timeline-value">
                                    ${timeline.seeded_location ? (timeline.seeded_location.includes('pastebin') ? 'Pastebin' : 'External') : 'Unknown'}
                                </span>
                            </div>
                            ${timeline.seeded_location ? `
                            <div class="timeline-details-row">
                                <span class="timeline-label">URL:</span>
                                <span class="timeline-value">
                                    <a href="${timeline.seeded_location}" target="_blank" style="color: #D4AF37;">${timeline.seeded_location.substring(0, 50)}...</a>
                                </span>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            } else {
                console.log('No seeded_at timestamp found');
            }

            // Access attempts
            if (timeline.accesses && timeline.accesses.length > 0) {
                console.log(`Rendering ${timeline.accesses.length} access attempts`);
                timeline.accesses.forEach((access, index) => {
                    console.log(`Access ${index}:`, access);
                    const scanner = identifyScanner(access.user_agent);
                    const eventId = `event-${index}`;

                    html += `
                        <div class="timeline-event triggered">
                            <div class="timeline-event-header" onclick="toggleEventDetails('${eventId}')">
                                <span class="timeline-icon">[ALERT]</span>
                                <span class="timeline-title">Access Attempt Detected</span>
                                <span class="expand-indicator" id="${eventId}-indicator">▼</span>
                                <span class="timeline-time">${formatTimestamp(access.accessed_at)}</span>
                            </div>
                            <div id="${eventId}" class="expandable-details">
                                <div class="timeline-details">
                                    <div class="timeline-details-row">
                                        <span class="timeline-label">Source IP:</span>
                                        <span class="timeline-value">${access.source_ip}</span>
                                    </div>
                                    ${access.geolocation && access.geolocation !== 'Unknown' ? `
                                    <div class="timeline-details-row">
                                        <span class="timeline-label">Location:</span>
                                        <span class="timeline-value">
                                            ${getLocationFromGeo(access.geolocation)}
                                        </span>
                                    </div>
                                    ` : ''}
                                    <div class="timeline-details-row">
                                        <span class="timeline-label">Scanner:</span>
                                        <span class="timeline-value">
                                            <span class="scanner-badge ${scanner.type}">${scanner.name}</span>
                                            ${scanner.isAutomated ? '<span style="color: #ef4444; margin-left: 8px;">[Automated]</span>' : '<span style="color: #fbbf24; margin-left: 8px;">[Manual]</span>'}
                                        </span>
                                    </div>
                                    <div class="timeline-details-row">
                                        <span class="timeline-label">Threat Level:</span>
                                        <span class="timeline-value">
                                            <span class="threat-level ${access.threat_level}">${access.threat_level.toUpperCase()}</span>
                                        </span>
                                    </div>
                                    <div class="timeline-details-row">
                                        <span class="timeline-label">User Agent:</span>
                                        <span class="timeline-value" style="font-size: 0.85em; word-break: break-all;">
                                            ${access.user_agent || 'Unknown'}
                                        </span>
                                    </div>
                                    ${access.request_type ? `
                                    <div class="timeline-details-row">
                                        <span class="timeline-label">Request Type:</span>
                                        <span class="timeline-value">${access.request_type}</span>
                                    </div>
                                    ` : ''}
                                </div>
                                <button class="check-ip-btn" onclick="checkIPReputation('${access.source_ip}', 'event-${index}')">
                                    Check IP Reputation
                                </button>
                                <div id="ip-reputation-event-${index}" style="display: none;"></div>
                            </div>
                        </div>
                    `;
                });
            } else {
                console.log('No access attempts found');
                html += `
                    <div class="timeline-event">
                        <div class="timeline-event-header">
                            <span class="timeline-icon">[INFO]</span>
                            <span class="timeline-title">No Access Attempts Yet</span>
                        </div>
                        <div class="timeline-details">
                            <div style="color: #888; font-size: 0.9em;">
                                This honeytoken has not been accessed yet. When an attacker discovers and attempts to use it, the access will appear here.
                            </div>
                        </div>
                    </div>
                `;
            }

            html += '</div>'; // Close timeline-container
            console.log('Timeline HTML generated, length:', html.length);
            container.innerHTML = html;
            console.log('=== TIMELINE RENDERING COMPLETE ===\n');
        }

        // Toggle Event Details
        function toggleEventDetails(eventId) {
            const details = document.getElementById(eventId);
            const indicator = document.getElementById(`${eventId}-indicator`);

            if (details.classList.contains('expanded')) {
                details.classList.remove('expanded');
                indicator.textContent = '▼';
            } else {
                details.classList.add('expanded');
                indicator.textContent = '▲';
            }
        }

        // Extract Location from Geolocation String
        function getLocationFromGeo(geolocation) {
            if (!geolocation || geolocation === 'Unknown') return 'Unknown';

            try {
                const geo = JSON.parse(geolocation);
                const city = geo.city || '';
                const country = geo.country || '';

                return `${city ? city + ', ' : ''}${country}`;
            } catch (e) {
                // If not JSON, try to parse as string
                return geolocation;
            }
        }

        // Render Attacker Intelligence
        function renderAttackerIntelligence(timeline, identifier) {
            const container = document.getElementById('attackerIntelligence');

            if (!timeline.accesses || timeline.accesses.length === 0) {
                container.style.display = 'none';
                return;
            }

            // Calculate intelligence
            const totalAttempts = timeline.accesses.length;
            const uniqueIPs = [...new Set(timeline.accesses.map(a => a.source_ip))];
            const countries = new Set();
            const scanners = new Set();
            let automatedCount = 0;
            let manualCount = 0;

            timeline.accesses.forEach(access => {
                // Extract country
                if (access.geolocation && access.geolocation !== 'Unknown') {
                    try {
                        const geo = JSON.parse(access.geolocation);
                        if (geo.country) countries.add(geo.country);
                    } catch (e) {}
                }

                // Identify scanner
                const scanner = identifyScanner(access.user_agent);
                scanners.add(scanner.name);
                if (scanner.isAutomated) {
                    automatedCount++;
                } else {
                    manualCount++;
                }
            });

            // Calculate time to first discovery
            let timeToDiscovery = 'N/A';
            if (timeline.seeded_at && timeline.first_access) {
                const seeded = new Date(timeline.seeded_at);
                const firstAccess = new Date(timeline.first_access);
                const diffMs = firstAccess - seeded;
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                const diffDays = Math.floor(diffHours / 24);

                if (diffDays > 0) {
                    timeToDiscovery = `${diffDays}d ${diffHours % 24}h`;
                } else {
                    timeToDiscovery = `${diffHours}h`;
                }
            }

            // Determine attack pattern
            const attackPattern = automatedCount > manualCount ? 'Automated' : (manualCount > automatedCount ? 'Manual' : 'Mixed');
            const isDemo = timeline.is_demo || identifier === DEMO_TOKEN_ID;

            let html = `
                <div class="intelligence-section">
                    <div class="intelligence-title">Attacker Intelligence Summary</div>
                    ${isDemo ? '<div class="demo-notice" style="margin: 10px 0;">This intelligence summary is based on example attack patterns</div>' : ''}

                    <div class="intelligence-grid">
                        <div class="intelligence-item">
                            <div class="intelligence-item-label">Total Attempts</div>
                            <div class="intelligence-item-value">${totalAttempts}</div>
                        </div>
                        <div class="intelligence-item">
                            <div class="intelligence-item-label">Unique IPs</div>
                            <div class="intelligence-item-value">${uniqueIPs.length}</div>
                        </div>
                        <div class="intelligence-item">
                            <div class="intelligence-item-label">Countries</div>
                            <div class="intelligence-item-value">${countries.size}</div>
                        </div>
                        <div class="intelligence-item">
                            <div class="intelligence-item-label">Time to Discovery</div>
                            <div class="intelligence-item-value">${timeToDiscovery}</div>
                        </div>
                    </div>

                    <div class="intelligence-list">
                        <div class="intelligence-list-title">Unique IP Addresses</div>
                        <div class="intelligence-list-items">
                            ${uniqueIPs.slice(0, 10).map(ip => `<div class="intelligence-chip">${ip}</div>`).join('')}
                            ${uniqueIPs.length > 10 ? `<div class="intelligence-chip">+${uniqueIPs.length - 10} more</div>` : ''}
                        </div>
                    </div>

                    ${countries.size > 0 ? `
                    <div class="intelligence-list">
                        <div class="intelligence-list-title">Countries Attacked From</div>
                        <div class="intelligence-list-items">
                            ${[...countries].map(country => `<div class="intelligence-chip">${getCountryFlag(country)} ${country}</div>`).join('')}
                        </div>
                    </div>
                    ` : ''}

                    <div class="intelligence-list">
                        <div class="intelligence-list-title">Scanners Detected</div>
                        <div class="intelligence-list-items">
                            ${[...scanners].map(scanner => `<div class="intelligence-chip">${scanner}</div>`).join('')}
                        </div>
                    </div>

                    <div class="intelligence-list">
                        <div class="intelligence-list-title">Attack Pattern</div>
                        <div class="intelligence-list-items">
                            <div class="intelligence-chip">
                                ${attackPattern}
                                (${automatedCount} automated, ${manualCount} manual)
                            </div>
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML = html;
            container.style.display = 'block';
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideInRight 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Check IP Reputation
        async function checkIPReputation(ip, eventId) {
            const button = event.target;
            const container = document.getElementById(`ip-reputation-${eventId}`);

            // If already showing, hide it
            if (container.style.display === 'block') {
                container.style.display = 'none';
                button.textContent = '🔍 Check IP Reputation';
                return;
            }

            // Show loading state
            button.disabled = true;
            button.textContent = '⏳ Checking...';

            try {
                console.log('Checking IP reputation for:', ip);

                const response = await fetch(`${API_URL}/api/ghost/bait/check-ip/${ip}`);
                const data = await response.json();

                if (data.success) {
                    displayIPReputation(data, container);
                    container.style.display = 'block';
                    button.textContent = 'IP Reputation Checked';
                    showToast('IP reputation check complete', 'success');
                } else {
                    throw new Error(data.error || 'Failed to check IP reputation');
                }
            } catch (error) {
                console.error('IP reputation check error:', error);
                showToast('Error checking IP reputation: ' + error.message, 'error');
                button.textContent = '🔍 Check IP Reputation';
            } finally {
                button.disabled = false;
            }
        }

        // Display IP Reputation Results
        function displayIPReputation(data, container) {
            // Determine threat badge class
            let threatClass = 'clean';
            if (data.threat_assessment === 'Known Scanner') {
                threatClass = 'scanner';
            } else if (data.threat_assessment === 'Suspicious') {
                threatClass = 'suspicious';
            }

            let html = `
                <div class="ip-reputation-container">
                    <div class="ip-reputation-title">
                        <span>🛡️ IP Reputation Report</span>
                        <span class="ip-reputation-badge ${threatClass}">${data.threat_assessment}</span>
                    </div>

                    <div class="ip-reputation-grid">
                        <div class="ip-reputation-item">
                            <span class="ip-reputation-label">Location:</span>
                            <span class="ip-reputation-value">${data.city}, ${data.country}</span>
                        </div>

                        <div class="ip-reputation-item">
                            <span class="ip-reputation-label">Company:</span>
                            <span class="ip-reputation-value">${data.company || data.isp}</span>
                        </div>

                        <div class="ip-reputation-item">
                            <span class="ip-reputation-label">Total Hits:</span>
                            <span class="ip-reputation-value">${data.hits_on_other_baits}</span>
                        </div>

                        <div class="ip-reputation-item">
                            <span class="ip-reputation-label">Unique Baits:</span>
                            <span class="ip-reputation-value">${data.unique_baits_hit}</span>
                        </div>
                    </div>

                    <div class="ip-reputation-flags">
            `;

            // Add warning flags
            if (data.is_vpn) {
                html += '<div class="ip-flag warning">[VPN] VPN Detected</div>';
            }
            if (data.is_proxy) {
                html += '<div class="ip-flag warning">[PROXY] Proxy Detected</div>';
            }
            if (data.is_hosting) {
                html += '<div class="ip-flag warning">[HOSTING] Hosting Provider</div>';
            }
            if (data.is_mobile) {
                html += '<div class="ip-flag">[MOBILE] Mobile Network</div>';
            }
            if (data.hits_on_other_baits >= 5) {
                html += '<div class="ip-flag danger">[ALERT] Known Scanner</div>';
            } else if (data.hits_on_other_baits >= 2) {
                html += '<div class="ip-flag warning">[WARNING] Multiple Attempts</div>';
            }

            html += '</div>';

            // Show baits hit if any
            if (data.baits_hit && data.baits_hit.length > 0) {
                html += `
                    <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(212, 175, 55, 0.2);">
                        <div style="color: #888; font-size: 0.85em; margin-bottom: 6px;">
                            Other Baits Hit by This IP:
                        </div>
                        <div style="display: flex; flex-wrap: wrap; gap: 6px;">
                `;

                data.baits_hit.forEach(bait => {
                    html += `<div class="intelligence-chip" style="font-size: 0.8em;">${bait}</div>`;
                });

                html += '</div></div>';
            }

            html += '</div>';

            container.innerHTML = html;
        }

        // Delete Bait Function
        async function deleteBait(identifier) {
            // Prevent deletion of demo token
            if (identifier === DEMO_TOKEN_ID) {
                showToast('Demo token cannot be deleted', 'error');
                return;
            }

            if (!confirm(`Delete honeytoken ${identifier}? This cannot be undone.`)) {
                return;
            }

            try {
                console.log('Deleting bait:', identifier);

                const response = await fetch(`${API_URL}/api/ghost/bait/delete/${identifier}`, {
                    method: 'DELETE'
                });

                console.log('Delete response status:', response.status);

                const responseText = await response.text();
                const data = JSON.parse(responseText);

                if (data.success) {
                    showToast(`Honeytoken ${identifier} deleted successfully`, 'success');

                    // Remove card from UI
                    const card = document.querySelector(`[data-bait-id="${identifier}"]`);
                    if (card) {
                        card.style.animation = 'fadeOut 0.3s';
                        setTimeout(() => card.remove(), 300);
                    }

                    // Refresh stats and lists
                    setTimeout(() => {
                        loadActiveHoneytokens();
                        refreshStats();
                    }, 500);
                } else {
                    throw new Error(data.error || 'Failed to delete honeytoken');
                }
            } catch (error) {
                console.error('Delete error:', error);
                showToast('Error deleting honeytoken: ' + error.message, 'error');
            }
        }

        // Refresh Statistics
        async function refreshStats() {
            try {
                const response = await fetch(`${API_URL}/api/ghost/bait/stats`);
                const data = await response.json();

                if (data.success && data.stats) {
                    document.getElementById('statTotalBaits').textContent = data.stats.total_baits || 0;
                    document.getElementById('statTotalAttempts').textContent = data.stats.total_attempts || 0;
                    document.getElementById('statUniqueIPs').textContent = data.stats.unique_ips || 0;
                    document.getElementById('statAvgTime').textContent = data.stats.attempts_today || 0;
                }
            } catch (error) {
                console.error('Error refreshing stats:', error);
            }
        }

        // Type Filter functionality
        document.getElementById('typeFilter').addEventListener('change', function(e) {
            const selectedType = e.target.value;
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();

            applyFilters(selectedType, searchTerm);
        });

        // Search functionality (updated to work with type filter)
        document.getElementById('searchBox').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const selectedType = document.getElementById('typeFilter').value;

            applyFilters(selectedType, searchTerm);
        });

        // Apply both filters
        function applyFilters(typeFilter, searchTerm) {
            const cards = document.querySelectorAll('.honeytoken-card');

            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                const baitType = card.getAttribute('data-bait-type');
                const serviceName = card.getAttribute('data-service-name');

                const matchesSearch = searchTerm === '' || text.includes(searchTerm);

                // Enhanced type matching: check both bait_type and service_name
                let matchesType = typeFilter === '';
                if (!matchesType) {
                    // Direct type match
                    matchesType = baitType === typeFilter;

                    // If filtering by api_token service (e.g., "stripe_token"),
                    // also match api_token with matching service_name
                    if (!matchesType && typeFilter.endsWith('_token') && serviceName) {
                        const serviceFromFilter = typeFilter.replace('_token', '');
                        matchesType = (baitType === 'api_token' && serviceName === serviceFromFilter);
                    }
                }

                card.style.display = (matchesSearch && matchesType) ? 'block' : 'none';
            });
        }

        // Update stats display labels
        document.addEventListener('DOMContentLoaded', function() {
            // Update the 4th stat label to show "Triggered Today"
            const statLabels = document.querySelectorAll('.mini-stat-label');
            if (statLabels.length >= 4) {
                statLabels[3].textContent = 'TRIGGERED TODAY';
            }
        });

        // Tutorial Modal Functions
        function showTutorial() {
            document.getElementById('tutorialModal').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('tutorialModal').style.opacity = '1';
            }, 10);
        }

        function closeTutorial() {
            const modal = document.getElementById('tutorialModal');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        // Close on ESC key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeTutorial();
            }
        });

        // Deployment Target Change Handler
        document.getElementById('deploymentTarget').addEventListener('change', function(e) {
            const target = e.target.value;
            const manualArea = document.getElementById('manualDeploymentArea');
            const deployBtn = document.getElementById('deployBtn');

            if (target === 'manual') {
                manualArea.style.display = 'block';
                deployBtn.textContent = 'Mark as Deployed';
                generateManualConfig();
            } else {
                manualArea.style.display = 'none';
                if (target.startsWith('pastebin')) {
                    deployBtn.textContent = '📤 Deploy to Pastebin';
                } else if (target.startsWith('github')) {
                    deployBtn.textContent = '📤 Deploy to GitHub Gist';
                }
            }
        });

        // Generate Manual Configuration
        function generateManualConfig() {
            if (!currentGeneratedBait) return;

            const cred = currentGeneratedBait;
            let config = '';

            if (cred.type === 'aws_credentials') {
                config = `# AWS Configuration
# Generated: ${new Date().toISOString()}
# DO NOT COMMIT TO VERSION CONTROL

[default]
aws_access_key_id = ${cred.aws_access_key_id}
aws_secret_access_key = ${cred.aws_secret_access_key}
region = ${cred.region}

# Account ID: ${cred.account_id}
`;
            } else if (cred.type === 'api_token') {
                config = `# ${cred.service_name.toUpperCase()} API Configuration
# Generated: ${new Date().toISOString()}
# CONFIDENTIAL - DO NOT SHARE

${cred.service_name.toUpperCase()}_API_KEY=${cred.token}
${cred.service_name.toUpperCase()}_API_SECRET=${cred.token}

# Service: ${cred.service_name}
`;
            } else if (cred.type === 'database_credentials') {
                config = `# Database Configuration
# Generated: ${new Date().toISOString()}
# PRODUCTION CREDENTIALS - KEEP SECURE

DB_TYPE=${cred.db_type}
DB_HOST=${cred.host}
DB_PORT=${cred.port}
DB_NAME=${cred.database}
DB_USER=${cred.username}
DB_PASSWORD=${cred.password}

DATABASE_URL=${cred.connection_string}
`;
            } else if (cred.type === 'ssh_key') {
                config = `# SSH Private Key
# ${cred.key_comment}
# DO NOT SHARE

${cred.private_key}

# Public Key:
# ${cred.public_key}
`;
            } else {
                config = JSON.stringify(cred, null, 2);
            }

            document.getElementById('manualConfigDisplay').textContent = config;
        }

        // Copy Manual Configuration
        async function copyManualConfig() {
            const config = document.getElementById('manualConfigDisplay').textContent;
            try {
                await navigator.clipboard.writeText(config);
                showToast('Configuration copied to clipboard!', 'success');
            } catch (error) {
                showToast('Failed to copy configuration', 'error');
            }
        }

        // Deployment Modal Functions
        let currentDeployIdentifier = null;

        function openDeployModal(identifier) {
            currentDeployIdentifier = identifier;
            const modal = document.getElementById('deployModal');
            modal.style.display = 'flex';
            setTimeout(() => {
                modal.style.opacity = '1';
            }, 10);

            // Reset form
            document.getElementById('deployTitle').value = '';
            document.getElementById('deployTarget').value = 'pastebin';
        }

        function closeDeployModal() {
            const modal = document.getElementById('deployModal');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
            currentDeployIdentifier = null;
        }

        async function submitDeployment() {
            if (!currentDeployIdentifier) {
                showToast('No token selected for deployment', 'error');
                return;
            }

            const title = document.getElementById('deployTitle').value.trim();
            const target = document.getElementById('deployTarget').value;

            if (!title) {
                showToast('Please enter a title for the deployment', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/api/ghost/bait/deploy`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        identifier: currentDeployIdentifier,
                        title: title,
                        target: target
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showToast('Honeytoken deployed successfully!', 'success');
                    closeDeployModal();

                    // Reload honeytokens to show updated deployment status
                    setTimeout(() => {
                        loadActiveHoneytokens();
                    }, 500);
                } else {
                    throw new Error(data.error || 'Failed to deploy honeytoken');
                }
            } catch (error) {
                console.error('Deploy error:', error);
                showToast('Error deploying honeytoken: ' + error.message, 'error');
            }
        }
    </script>

    <!-- Deployment Modal -->
    <div id="deployModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); z-index: 2000; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s;" onclick="event.target === this && closeDeployModal()">
        <div style="background: #000; border: 2px solid #D4AF37; border-radius: 12px; max-width: 500px; width: 90%; padding: 30px; position: relative; box-shadow: 0 0 40px rgba(212, 175, 55, 0.3);" onclick="event.stopPropagation()">
            <button onclick="closeDeployModal()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; color: #D4AF37; font-size: 1.5em; cursor: pointer; padding: 5px 10px;">×</button>

            <h2 style="color: #D4AF37; font-size: 1.5em; margin-bottom: 20px;">Deploy Honeytoken</h2>

            <div style="color: #aaa; margin-bottom: 20px; font-size: 0.9em;">
                Deploy this honeytoken to a public location where attackers might discover it.
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #D4AF37; margin-bottom: 8px; font-size: 0.9em;">Deployment Title</label>
                <input type="text" id="deployTitle" placeholder="e.g., Production AWS Keys Backup" style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 6px; color: #fff; font-size: 1em;">
                <div style="color: #888; font-size: 0.8em; margin-top: 5px;">Make it look realistic to attract attackers</div>
            </div>

            <div style="margin-bottom: 25px;">
                <label style="display: block; color: #D4AF37; margin-bottom: 8px; font-size: 0.9em;">Deployment Target</label>
                <select id="deployTarget" style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 6px; color: #fff; font-size: 1em;">
                    <option value="pastebin">Pastebin (Automatic)</option>
                    <option value="manual">Manual (Copy & Deploy Yourself)</option>
                </select>
            </div>

            <div style="display: flex; gap: 10px;">
                <button onclick="submitDeployment()" style="flex: 1; padding: 12px; background: rgba(212, 175, 55, 0.1); border: 1px solid #D4AF37; border-radius: 6px; color: #D4AF37; font-size: 1em; cursor: pointer; font-weight: 600;">
                    Deploy Now
                </button>
                <button onclick="closeDeployModal()" style="flex: 1; padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; color: #aaa; font-size: 1em; cursor: pointer;">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Tutorial Modal -->
    <div id="tutorialModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); z-index: 2000; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s;" onclick="event.target === this && closeTutorial()">
        <div style="background: #000; border: 2px solid #D4AF37; border-radius: 12px; max-width: 800px; max-height: 90vh; overflow-y: auto; padding: 40px; position: relative; box-shadow: 0 0 40px rgba(212, 175, 55, 0.3);">
            <button onclick="closeTutorial()" style="position: absolute; top: 20px; right: 20px; background: none; border: none; color: #D4AF37; font-size: 1.5em; cursor: pointer; padding: 5px 10px;">×</button>

            <h2 style="color: #D4AF37; font-size: 2em; margin-bottom: 20px;">BAIT Module Tutorial</h2>

            <div style="color: #aaa; line-height: 1.8;">
                <h3 style="color: #D4AF37; margin-top: 25px; margin-bottom: 15px;">📚 WHAT IS BAIT?</h3>
                <p>BAIT (Breadcrumb Analysis & Intelligence Tracking) is a reality-integrated honeytoken system. Unlike traditional honeypots that create fake infrastructure, BAIT deploys fake credentials into real-world locations where attackers actually hunt for secrets: GitHub repositories, Pastebin dumps, Discord servers, and misconfigured S3 buckets.</p>
                <p>When an attacker discovers and tries to use your honeytoken, you get immediate notification with full context: their IP address, location, tools they're using, and behavioral patterns. This provides concrete evidence of active targeting and helps you understand real-world attacker tradecraft.</p>

                <h3 style="color: #D4AF37; margin-top: 25px; margin-bottom: 15px;">🎯 HOW TO USE BAIT:</h3>

                <div style="background: rgba(212, 175, 55, 0.05); border-left: 3px solid #D4AF37; padding: 15px; margin: 15px 0;">
                    <h4 style="color: #D4AF37; margin-bottom: 10px;">Step 1: Generate a Honeytoken</h4>
                    <p>Choose a credential type that matches your threat model:</p>
                    <ul style="margin-left: 20px;">
                        <li><strong>AWS Keys:</strong> Perfect for cloud-targeting attackers</li>
                        <li><strong>API Tokens:</strong> Attracts data scrapers and credential stuffers</li>
                        <li><strong>Database Credentials:</strong> Catches SQL injection and database scanners</li>
                        <li><strong>SSH Keys:</strong> Identifies lateral movement attempts</li>
                    </ul>
                    <p>Each credential contains a unique tracking identifier that's invisible to attackers but allows us to trace usage back to your specific deployment.</p>
                </div>

                <div style="background: rgba(212, 175, 55, 0.05); border-left: 3px solid #D4AF37; padding: 15px; margin: 15px 0;">
                    <h4 style="color: #D4AF37; margin-bottom: 10px;">Step 2: Deploy to Public Surface</h4>
                    <p>Post your honeytoken where attackers are actively searching:</p>
                    <ul style="margin-left: 20px;">
                        <li><strong>Pastebin:</strong> One of the largest sources of leaked credentials</li>
                        <li><strong>GitHub Gists:</strong> Attackers scan for accidentally committed secrets</li>
                        <li><strong>Manual Deployment:</strong> Post to forums, Discord, Slack, or anywhere</li>
                    </ul>
                    <p>Make it look realistic! Use titles like "Production AWS Backup" or "Database Config - DO NOT SHARE" to increase authenticity.</p>
                </div>

                <div style="background: rgba(212, 175, 55, 0.05); border-left: 3px solid #D4AF37; padding: 15px; margin: 15px 0;">
                    <h4 style="color: #D4AF37; margin-bottom: 10px;">Step 3: Monitor for Detection</h4>
                    <p>Watch the "Deployed Honeytokens" panel:</p>
                    <ul style="margin-left: 20px;">
                        <li><strong>🟢 ACTIVE:</strong> Deployed and monitoring (no one has tried it yet)</li>
                        <li><strong>🔴 TRIGGERED:</strong> Someone attempted to use your honeytoken!</li>
                    </ul>
                    <p>The "Threat Detection Feed" shows real-time alerts as attackers discover your baits. You'll see their IP addresses, geolocation, and what tools they're using (curl, Python scripts, AWS CLI, etc.).</p>
                </div>

                <div style="background: rgba(212, 175, 55, 0.05); border-left: 3px solid #D4AF37; padding: 15px; margin: 15px 0;">
                    <h4 style="color: #D4AF37; margin-bottom: 10px;">Step 4: Analyze Attacker Behavior</h4>
                    <p>Click "View Timeline" on any triggered honeytoken to see:</p>
                    <ul style="margin-left: 20px;">
                        <li><strong>Timeline:</strong> Every access attempt with timestamps</li>
                        <li><strong>Geolocation Data:</strong> Where attackers are operating from</li>
                        <li><strong>Tool Fingerprinting:</strong> What scanners and automation they use</li>
                        <li><strong>Threat Scoring:</strong> Automated risk assessment (LOW/MEDIUM/HIGH/CRITICAL)</li>
                    </ul>
                    <p>Use this intelligence to understand if you're being actively targeted, what tactics attackers are using, and whether they're sophisticated threat actors or opportunistic script kiddies.</p>
                </div>

                <h3 style="color: #D4AF37; margin-top: 25px; margin-bottom: 15px;">🎯 WHY THIS MATTERS:</h3>
                <p>Traditional security is reactive - you only find out about breaches after damage is done. BAIT is proactive threat intelligence. You're not waiting for attackers to compromise real systems; you're observing them in controlled conditions. This gives you:</p>
                <ul style="margin-left: 20px;">
                    <li><strong>Early Warning:</strong> Know you're being targeted before real credentials are stolen</li>
                    <li><strong>Attribution Data:</strong> IP addresses, geolocation, and TTPs for incident response</li>
                    <li><strong>Threat Intelligence:</strong> Understand attacker tools, techniques, and procedures</li>
                    <li><strong>Legal Evidence:</strong> Concrete proof of unauthorized access attempts</li>
                </ul>
            </div>

            <button onclick="closeTutorial()" class="deploy-btn" style="width: 100%; margin-top: 25px;">Got It!</button>
        </div>
    </div>
</body>
</html>
